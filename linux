#!/bin/bash

# List of Git repo URLs
REPOS=(
  "git@github.com:your-org/service-a.git"
  "git@github.com:your-org/service-b.git"
)

BRANCHES=("sit-release" "main")
PREFIX="1"

for REPO in "${REPOS[@]}"; do
  NAME=$(basename "$REPO" .git)

  for BRANCH in "${BRANCHES[@]}"; do
    TARGET="${PREFIX}.${NAME}-${BRANCH}"

    echo "üîÑ Cloning $REPO [$BRANCH] into $TARGET..."
    git clone --single-branch --branch "$BRANCH" "$REPO" "$TARGET"

    # Move contents from inner <repo> folder if it exists
    if [ -d "$TARGET/$NAME" ]; then
      echo "üì¶ Moving $NAME contents to $TARGET..."
      shopt -s dotglob
      mv "$TARGET/$NAME"/* "$TARGET/"
      rm -rf "$TARGET/$NAME"
      shopt -u dotglob
      echo "‚úÖ Cleaned $TARGET/$NAME"
    else
      echo "‚ö†Ô∏è No inner folder $TARGET/$NAME found ‚Äî skipping move"
    fi
  done
done

echo "‚úÖ All repositories and branches processed."
