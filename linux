#!/bin/bash

# GitHub token (keep it safe)
GITHUB_TOKEN="ghp_your_actual_token"

# List of repositories (format: owner/repo)
REPOS=(
  "your-org/repo1"
  "your-org/repo2"
)

for REPO in "${REPOS[@]}"; do
  echo "üîç Checking latest PR in $REPO..."

  # Get the latest open PR number
  PR_DATA=$(curl -s -H "Authorization: token $GITHUB_TOKEN" \
    "https://api.github.com/repos/$REPO/pulls?state=open&sort=created&direction=desc&per_page=1")

  PR_NUMBER=$(echo "$PR_DATA" | jq '.[0].number')

  if [ "$PR_NUMBER" != "null" ] && [ -n "$PR_NUMBER" ]; then
    echo "üöÄ Merging PR #$PR_NUMBER in $REPO..."

    # Merge the PR using the API
    curl -s -X PUT -H "Authorization: token $GITHUB_TOKEN" \
      -H "Content-Type: application/json" \
      -d '{"merge_method":"merge"}' \
      "https://api.github.com/repos/$REPO/pulls/$PR_NUMBER/merge"

    echo "‚úÖ PR #$PR_NUMBER merged in $REPO"
  else
    echo "‚ö†Ô∏è No open PRs found in $REPO"
  fi

  echo "-----------------------------"
done
